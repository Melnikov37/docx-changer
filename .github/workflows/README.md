# GitHub Actions CI/CD

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–µ–ø–ª–æ—è –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ GitHub Actions.

## üìã Workflows

### 1. Deploy (`deploy.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä:** Push –≤ `main` –≤–µ—Ç–∫—É

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ VPS –ø–æ SSH
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–¥ –∏–∑ GitHub
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç MinIO
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

**–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:**
1. GitHub ‚Üí Actions ‚Üí Deploy to VPS
2. Click "Run workflow"

### 2. Test (`test.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä:** Push –≤ `main`/`develop` –∏–ª–∏ Pull Request

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç Python —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ template —Ñ–∞–π–ª–æ–≤
- ‚úÖ –°–∫–∞–Ω–∏—Ä—É–µ—Ç –Ω–∞ security issues

### 3. Backup (`backup.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 3:00 UTC (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø SQLite –±–∞–∑—ã
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø MinIO –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ ~/backups/ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –£–¥–∞–ª—è–µ—Ç –±—ç–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π

**–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:**
1. GitHub ‚Üí Actions ‚Üí Scheduled Backup
2. Click "Run workflow"

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Secrets

–î–æ–±–∞–≤—å—Ç–µ –≤ GitHub ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions:

| Secret | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|--------|----------|--------|
| `SSH_PRIVATE_KEY` | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á | `-----BEGIN OPENSSH...` |
| `VPS_HOST` | IP –∏–ª–∏ –¥–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞ | `85.239.39.232` |
| `VPS_USER` | SSH –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | `root` |

### –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å SSH –∫–ª—é—á –¥–ª—è GitHub Actions:

```bash
# –ù–∞ –≤–∞—à–µ–º Mac
ssh-keygen -t ed25519 -C "github-actions" -f ~/.ssh/github_actions
# –ü–∞—Ä–æ–ª—å: –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º (–ø—Ä–æ—Å—Ç–æ Enter)

# –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ VPS
ssh-copy-id -i ~/.ssh/github_actions.pub root@85.239.39.232

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/github_actions
# –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ GitHub Secret SSH_PRIVATE_KEY
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

```bash
# –ù–∞ –≤–∞—à–µ–º Mac
git add .
git commit -m "Update feature"
git push origin main

# GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç —Ç–µ—Å—Ç—ã
# 2. –ó–∞–¥–µ–ø–ª–æ–∏—Ç –Ω–∞ VPS
# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
```

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Actions

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ GitHub ‚Üí Actions
2. –í—ã–±–µ—Ä–∏—Ç–µ "Deploy to VPS"
3. –ù–∞–∂–º–∏—Ç–µ "Run workflow"
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É (–æ–±—ã—á–Ω–æ `main`)
5. –ù–∞–∂–º–∏—Ç–µ "Run workflow" –µ—â–µ —Ä–∞–∑

### –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π (–±–µ–∑ GitHub Actions)

```bash
# –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
./scripts/deploy/update.sh

# –ò–ª–∏ —É–¥–∞–ª–µ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π
./scripts/deploy/remote.sh 85.239.39.232 root
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–µ–ø–ª–æ—è

GitHub ‚Üí Actions ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π workflow

**–°—Ç–∞—Ç—É—Å—ã:**
- ‚úÖ –ó–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞ - —É—Å–ø–µ—à–Ω–æ
- ‚ùå –ö—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ - –æ—à–∏–±–∫–∞
- üü° –ñ–µ–ª—Ç—ã–π –∫—Ä—É–∂–æ–∫ - –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

### –õ–æ–≥–∏ –¥–µ–ø–ª–æ—è

1. GitHub ‚Üí Actions ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ workflow
2. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ job "deploy"
3. –†–∞—Å–∫—Ä–æ–π—Ç–µ —à–∞–≥–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤

## üîß –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –î–µ–ø–ª–æ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Secrets:**
   - GitHub ‚Üí Settings ‚Üí Secrets ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ 3 —Å–µ–∫—Ä–µ—Ç–∞

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –¥–æ—Å—Ç—É–ø:**
   ```bash
   ssh root@85.239.39.232 "echo 'SSH works'"
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ VPS:**
   ```bash
   ssh root@85.239.39.232
   journalctl -u docxapp -n 50
   ```

### –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ GitHub Actions
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ:
   ```bash
   python -m py_compile app.py db.py s3_client.py
   ```

### –ë—ç–∫–∞–ø—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ workflow –≤–∫–ª—é—á–µ–Ω: Actions ‚Üí Scheduled Backup
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ `backup.yml`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–µ—Å—Ç–∞

## üéØ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –î–µ–ø–ª–æ–π –Ω–∞ staging

–°–æ–∑–¥–∞–π—Ç–µ `.github/workflows/deploy-staging.yml`:

```yaml
name: Deploy to Staging

on:
  push:
    branches: [ develop ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - env:
          SSH_HOST: ${{ secrets.STAGING_HOST }}
        run: ./scripts/deploy/remote.sh
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

–î–æ–±–∞–≤—å—Ç–µ –≤ workflow:

```yaml
- name: Send Telegram notification
  if: always()
  env:
    TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
    TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
  run: |
    curl -s -X POST \
      https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage \
      -d chat_id=${TELEGRAM_CHAT_ID} \
      -d text="‚úÖ Deployment successful!"
```

## üìù Best Practices

1. **–í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –ø–µ—Ä–µ–¥ merge –≤ main
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Pull Requests** –¥–ª—è code review
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** GitHub Actions
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –±—ç–∫–∞–ø—ã** —Ä–∞–∑ –≤ –º–µ—Å—è—Ü
5. **–û–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** —Ä–µ–≥—É–ª—è—Ä–Ω–æ

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–æ–±–ª–µ–º—ã? –°–æ–∑–¥–∞–π—Ç–µ issue –≤ GitHub —Å:
- –û–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã
- –õ–æ–≥–∞–º–∏ –∏–∑ GitHub Actions
- –õ–æ–≥–∞–º–∏ —Å VPS (`journalctl -u docxapp`)
